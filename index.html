<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Valentine ❤️</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
            user-select: none;
            touch-action: manipulation;
        }
        
        /* Screen styles */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            transition: opacity 1s ease, transform 1s ease;
            z-index: 10;
        }
        
        .screen.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }
        
        /* Start screen */
        #start-screen {
            background-color: #000;
            z-index: 100;
            cursor: pointer;
        }
        
        .touch-to-continue {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: #ff5e8e;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Name screen */
        #name-screen {
            background: linear-gradient(135deg, #1a001a 0%, #330033 100%);
            cursor: pointer;
        }
        
        .heart-icon {
            font-size: 60px;
            color: #ff5e8e;
            margin-bottom: 20px;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .recipient-name {
            font-family: 'Dancing Script', cursive;
            font-size: 64px;
            color: #ff5e8e;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 94, 142, 0.5);
        }
        
        /* Memory screen */
        #memory-screen {
            background: linear-gradient(135deg, #330033 0%, #660066 100%);
            cursor: pointer;
        }
        
        .memory-text {
            font-size: 48px;
            color: #ffb6c1;
            font-family: 'Dancing Script', cursive;
            margin-bottom: 30px;
        }
        
        /* Location screen */
        #location-screen {
            background-color: #000;
        }
        
        .location-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .location-header {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        
        .location-title {
            font-size: 28px;
            color: #ff5e8e;
            margin-bottom: 10px;
        }
        
        .location-instructions {
            font-size: 16px;
            color: #ffb6c1;
        }
        
        .streetview-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .heart-marker {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: #ff5e8e;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255, 94, 142, 0.8);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
            animation: pulse 2s infinite;
            border: 2px solid white;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 94, 142, 0.8); }
            50% { box-shadow: 0 0 30px rgba(255, 94, 142, 1); }
        }
        
        .heart-marker:hover {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 30px rgba(255, 94, 142, 1);
        }
        
        .heart-marker.found {
            opacity: 0.5;
            transform: translate(-50%, -50%) scale(0.8);
            pointer-events: none;
            animation: none;
        }
        
        .heart-marker i {
            color: white;
            font-size: 24px;
        }
        
        .message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }
        
        .message-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .message-content {
            max-width: 700px;
            width: 90%;
            background: linear-gradient(135deg, rgba(102, 0, 102, 0.9), rgba(51, 0, 51, 0.9));
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
            border: 3px solid #ff5e8e;
            position: relative;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-message-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #ffb6c1;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-message-btn:hover {
            background-color: rgba(255, 94, 142, 0.2);
            color: #ff5e8e;
            transform: rotate(90deg);
        }
        
        .message-title {
            font-size: 24px;
            color: #ffb6c1;
            margin-bottom: 20px;
            font-family: 'Dancing Script', cursive;
        }
        
        .message-text {
            font-size: 18px;
            line-height: 1.7;
            color: #fff;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .continue-btn {
            background: linear-gradient(to right, #ff5e8e, #ff3d7a);
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(255, 94, 142, 0.4);
            display: block;
            margin: 0 auto;
        }
        
        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 94, 142, 0.6);
        }
        
        .continue-btn:active {
            transform: translateY(-1px);
        }
        
        .continue-btn:disabled {
            background: linear-gradient(to right, #666, #777);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .progress-text {
            color: #ffb6c1;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .progress-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #444;
            transition: all 0.3s;
        }
        
        .progress-dot.active {
            background-color: #ff5e8e;
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(255, 94, 142, 0.7);
        }
        
        .progress-dot.found {
            background-color: #ffb6c1;
        }
        
        /* Final screen */
        #final-screen {
            background: linear-gradient(135deg, #000033 0%, #330033 100%);
            overflow-y: auto;
            padding: 40px 20px;
            cursor: default;
        }
        
        .love-letter-container {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.85);
            padding: 60px;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            border: 3px solid #ff5e8e;
            animation: fadeIn 1.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .love-letter-header {
            font-family: 'Dancing Script', cursive;
            font-size: 48px;
            color: #ff5e8e;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .love-letter-content {
            font-size: 20px;
            line-height: 1.9;
            color: #fff;
            white-space: pre-line;
            text-align: left;
        }
        
        .final-heart {
            font-size: 80px;
            color: #ff5e8e;
            margin-top: 50px;
            animation: heartbeat 1.5s infinite;
            text-align: center;
        }
        
        /* Music player */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.85);
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 94, 142, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .music-btn {
            background: none;
            border: none;
            color: #ff5e8e;
            font-size: 24px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .music-btn:hover {
            background-color: rgba(255, 94, 142, 0.2);
            transform: scale(1.1);
        }
        
        .music-info {
            font-size: 15px;
            color: #ffb6c1;
            font-weight: 500;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .recipient-name {
                font-size: 48px;
            }
            
            .memory-text {
                font-size: 36px;
            }
            
            .location-title {
                font-size: 22px;
            }
            
            .love-letter-header {
                font-size: 36px;
            }
            
            .love-letter-content {
                font-size: 18px;
            }
            
            .heart-marker {
                width: 45px;
                height: 45px;
            }
            
            .message-content {
                padding: 30px 25px;
                margin: 15px;
            }
            
            .love-letter-container {
                padding: 40px 25px;
            }
            
            .music-player {
                bottom: 15px;
                right: 15px;
                padding: 10px 20px;
            }
        }
        
        @media (max-width: 480px) {
            .recipient-name {
                font-size: 36px;
            }
            
            .memory-text {
                font-size: 28px;
            }
            
            .love-letter-header {
                font-size: 32px;
            }
            
            .love-letter-content {
                font-size: 16px;
                line-height: 1.7;
            }
            
            .love-letter-container {
                padding: 30px 20px;
            }
            
            .heart-marker {
                width: 40px;
                height: 40px;
            }
            
            .heart-marker i {
                font-size: 20px;
            }
            
            .message-content {
                padding: 25px 20px;
            }
            
            .music-player {
                bottom: 10px;
                right: 10px;
                padding: 8px 15px;
            }
            
            .music-info {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="start-screen" class="screen">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <h1 style="font-size: 36px; color: #ff5e8e; margin-bottom: 20px;">For My Valentine ❤️</h1>
        <p style="font-size: 20px; color: #ffb6c1; max-width: 600px; line-height: 1.6; padding: 0 20px;">
            A journey through our most precious memories
        </p>
        <div class="touch-to-continue">
            <i class="fas fa-hand-point-up"></i> Touch anywhere to continue
        </div>
    </div>
    
    <!-- Name Screen -->
    <div id="name-screen" class="screen hidden">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <p style="font-size: 24px; color: #ffb6c1; margin-bottom: 10px;">This is for you, my love</p>
        <h1 id="recipient-name" class="recipient-name">Sarah</h1>
        <p style="font-size: 20px; color: #ffb6c1; margin-top: 20px; max-width: 600px; padding: 0 20px;">
            Every moment with you is a treasure
        </p>
    </div>
    
    <!-- Memory Screen -->
    <div id="memory-screen" class="screen hidden">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <h1 class="memory-text">Remember when...</h1>
        <p style="font-size: 22px; color: #ffb6c1; max-width: 700px; line-height: 1.6; padding: 0 20px;">
            We started this beautiful journey together?<br>
            Let's revisit our special places...
        </p>
    </div>
    
    <!-- Location Screen -->
    <div id="location-screen" class="screen hidden">
        <div class="location-container">
            <div class="location-header">
                <h1 id="location-title" class="location-title">Our First Date</h1>
                <p class="location-instructions">
                    <i class="fas fa-heart" style="color: #ff5e8e;"></i> 
                    Click on the heart markers to reveal hidden messages. Find all messages to continue.
                </p>
                <div class="progress-container">
                    <span class="progress-text">Memories found:</span>
                    <!-- Progress dots will be added here by JavaScript -->
                </div>
            </div>
            <div class="streetview-container">
                <div id="streetview"></div>
                <!-- Heart markers will be added here by JavaScript -->
                
                <!-- Message overlay -->
                <div id="message-overlay" class="message-overlay">
                    <div class="message-content">
                        <button id="close-message-btn" class="close-message-btn" title="Close message">
                            <i class="fas fa-times"></i>
                        </button>
                        <h2 id="message-title" class="message-title">A Special Memory</h2>
                        <p id="message-text" class="message-text">
                            This is where we first met. I was so nervous, but the moment I saw you, I knew something special was beginning.
                        </p>
                        <button id="continue-message-btn" class="continue-btn">Continue</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Final Screen -->
    <div id="final-screen" class="screen hidden">
        <div class="love-letter-container">
            <h1 id="love-letter-header" class="love-letter-header">To My Forever Valentine</h1>
            <div id="love-letter-content" class="love-letter-content">
                My dearest love,

                As we journey through all the places that hold our most precious memories, I'm reminded of how incredibly blessed I am to have you in my life. Each location tells a story of our love - from nervous beginnings to comfortable familiarity, from joyful laughter to quiet understanding.

                You are the most beautiful person I know, inside and out. Your kindness touches everyone around you, your strength inspires me daily, and your love has transformed my world in ways I never imagined possible.

                No matter where life takes us, my heart will always find its home with you. Thank you for every moment, every memory, and every tomorrow we'll share together.

                Forever and always,
                Yours
            </div>
            <div class="final-heart">
                <i class="fas fa-heart"></i>
            </div>
        </div>
    </div>
    
    <!-- Music Player -->
    <div class="music-player">
        <button id="music-toggle" class="music-btn" title="Toggle music">
            <i class="fas fa-volume-up"></i>
        </button>
        <div class="music-info">
            Romantic Music
        </div>
    </div>

    <script>
        // ================================
        // CUSTOMIZATION SECTION
        // ================================
        
        // 1. CHANGE YOUR PARTNER'S NAME HERE
        const recipientName = "Sarah";
        
        // 2. CHANGE FINAL LOVE MESSAGE HERE
        const loveMessage = {
            header: "To My Forever Valentine",
            content: `My dearest love,

As we journey through all the places that hold our most precious memories, I'm reminded of how incredibly blessed I am to have you in my life. Each location tells a story of our love - from nervous beginnings to comfortable familiarity, from joyful laughter to quiet understanding.

You are the most beautiful person I know, inside and out. Your kindness touches everyone around you, your strength inspires me daily, and your love has transformed my world in ways I never imagined possible.

No matter where life takes us, my heart will always find its home with you. Thank you for every moment, every memory, and every tomorrow we'll share together.

Forever and always,
Yours`
        };
        
        // 3. CHANGE LOCATIONS & MESSAGES HERE
        // Get Street View URLs from Google Maps:
        // 1. Go to Google Maps → Find location
        // 2. Enter Street View → Click "Share" → "Embed a map"
        // 3. Copy the iframe URL → Paste in streetViewUrl below
        const locations = [
            {
                name: "Our First Date",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1700000000000!6m8!1m7!1sCAoSLEFGMVFpcE5fV3JhRjJwLXFmS1JTTGtYb0hEMjBqN19wOUo4VUprTjN2M184!2m2!1d40.748817!2d-73.985428!3f355.54!4f0!5f0.7820865974627469",
                messages: [
                    "This is where we first met. I was so nervous, but the moment I saw you, I knew something special was beginning.",
                    "I remember how you smiled when you saw me. That smile still melts my heart every single day.",
                    "We talked for hours without realizing how much time had passed. Time flies when I'm with you."
                ],
                heartPositions: [
                    { x: 30, y: 50 },  // Percentage positions
                    { x: 70, y: 30 },
                    { x: 50, y: 70 }
                ]
            },
            {
                name: "Our Favorite Park",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1700000000001!6m8!1m7!1sCAoSLEFGMVFpcE5fV3JhRjJwLXFmS1JTTGtYb0hEMjBqN19wOUo4VUprTjN2M184!2m2!1d40.7831!2d-73.9712!3f0!4f0!5f0.7820865974627469",
                messages: [
                    "We spent countless sunny afternoons here, just talking and dreaming about our future.",
                    "This is where we had our first picnic. You packed my favorite foods without even asking.",
                    "Remember when we got caught in the rain here? We laughed so hard as we ran for shelter."
                ],
                heartPositions: [
                    { x: 20, y: 60 },
                    { x: 60, y: 40 },
                    { x: 80, y: 70 }
                ]
            },
            {
                name: "The Coffee Shop",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1700000000002!6m8!1m7!1sCAoSLEFGMVFpcE5fV3JhRjJwLXFmS1JTTGtYb0hEMjBqN19wOUo4VUprTjN2M184!2m2!1d40.7489!2d-73.9680!3f0!4f0!5f0.7820865974627469",
                messages: [
                    "Our Saturday morning ritual - coffee, pastries, and planning our adventures.",
                    "This is where you first told me you loved me. I'll never forget that moment.",
                    "We've solved all the world's problems at this little table, one coffee at a time."
                ],
                heartPositions: [
                    { x: 40, y: 40 },
                    { x: 75, y: 60 },
                    { x: 25, y: 75 }
                ]
            },
            {
                name: "The Beach at Sunset",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1700000000003!6m8!1m7!1sCAoSLEFGMVFpcE5fV3JhRjJwLXFmS1JTTGtYb0hEMjBqN19wOUo4VUprTjN2M184!2m2!1d40.5795!2d-73.9822!3f0!4f0!5f0.7820865974627469",
                messages: [
                    "We watched the sun dip below the horizon, your hand in mine, feeling like the only two people in the world.",
                    "You wrote our names in the sand here. The tide washed them away, but our love remains.",
                    "This is where we promised to always find time for sunsets together, no matter how busy life gets."
                ],
                heartPositions: [
                    { x: 30, y: 30 },
                    { x: 65, y: 50 },
                    { x: 45, y: 80 }
                ]
            },
            {
                name: "Home",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1700000000004!6m8!1m7!1sCAoSLEFGMVFpcE5fV3JhRjJwLXFmS1JTTGtYb0hEMjBqN19wOUo4VUprTjN2M184!2m2!1d40.7549!2d-73.9840!3f0!4f0!5f0.7820865974627469",
                messages: [
                    "Not just a place, but where our hearts found a home together.",
                    "This is where we build our life together, one beautiful day at a time.",
                    "My favorite place in the world is wherever you are, but this comes pretty close."
                ],
                heartPositions: [
                    { x: 50, y: 40 },
                    { x: 35, y: 65 },
                    { x: 70, y: 75 }
                ]
            }
        ];
        
        // ================================
        // ENHANCED APPLICATION CODE
        // ================================
        
        // State variables
        let currentScreen = 0;
        let currentLocation = 0;
        let foundMessages = 0;
        let musicPlaying = false;
        let isFirstInteraction = true;
        
        // DOM Elements
        const screens = [
            document.getElementById('start-screen'),
            document.getElementById('name-screen'),
            document.getElementById('memory-screen'),
            document.getElementById('location-screen'),
            document.getElementById('final-screen')
        ];
        
        const recipientNameElement = document.getElementById('recipient-name');
        const locationTitle = document.getElementById('location-title');
        const streetviewContainer = document.getElementById('streetview');
        const messageOverlay = document.getElementById('message-overlay');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const continueMessageBtn = document.getElementById('continue-message-btn');
        const closeMessageBtn = document.getElementById('close-message-btn');
        const loveLetterHeader = document.getElementById('love-letter-header');
        const loveLetterContent = document.getElementById('love-letter-content');
        const musicToggle = document.getElementById('music-toggle');
        const musicInfo = document.querySelector('.music-info');
        
        // Audio - Using a reliable royalty-free music source
        const backgroundMusic = new Audio('https://cdn.pixabay.com/download/audio/2022/02/22/audio_d5e2e1c7a3.mp3?filename=romantic-piano-soft-amp-sad-11080.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.6;
        
        // Initialize the application
        function init() {
            // Set recipient name
            recipientNameElement.textContent = recipientName;
            
            // Set love letter
            loveLetterHeader.textContent = loveMessage.header;
            loveLetterContent.textContent = loveMessage.content;
            
            // Setup click handlers
            setupEventListeners();
            
            // Show first screen
            showScreen(0);
            
            // Setup music with user interaction requirement
            setupMusic();
        }
        
        // Setup all event listeners
        function setupEventListeners() {
            // Screen click handlers
            screens[0].addEventListener('click', () => showScreen(1));
            screens[1].addEventListener('click', () => showScreen(2));
            screens[2].addEventListener('click', () => {
                showScreen(3);
                setTimeout(() => {
                    loadLocation(0);
                }, 100);
            });
            
            // Message buttons
            continueMessageBtn.addEventListener('click', continueToNext);
            closeMessageBtn.addEventListener('click', closeMessage);
            
            // Music toggle
            musicToggle.addEventListener('click', toggleMusic);
            
            // Keyboard support for closing messages
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && messageOverlay.classList.contains('active')) {
                    closeMessage();
                }
            });
        }
        
        // Setup music with user interaction requirement
        function setupMusic() {
            // Start music on first user interaction (for browser autoplay policies)
            const startMusicOnInteraction = () => {
                if (isFirstInteraction && !musicPlaying) {
                    playMusic();
                    isFirstInteraction = false;
                    // Remove these listeners after first interaction
                    document.removeEventListener('click', startMusicOnInteraction);
                    document.removeEventListener('touchstart', startMusicOnInteraction);
                }
            };
            
            document.addEventListener('click', startMusicOnInteraction);
            document.addEventListener('touchstart', startMusicOnInteraction);
            
            // Update music info text
            musicInfo.textContent = "Click to play music";
        }
        
        // Play music
        function playMusic() {
            backgroundMusic.play().then(() => {
                musicPlaying = true;
                musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                musicInfo.textContent = "Romantic Music";
                musicToggle.title = "Pause music";
            }).catch(e => {
                console.log("Music play failed, waiting for user interaction:", e);
                musicInfo.textContent = "Click to play music";
                musicToggle.title = "Play music";
            });
        }
        
        // Pause music
        function pauseMusic() {
            backgroundMusic.pause();
            musicPlaying = false;
            musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
            musicInfo.textContent = "Music paused";
            musicToggle.title = "Play music";
        }
        
        // Toggle music
        function toggleMusic() {
            if (musicPlaying) {
                pauseMusic();
            } else {
                playMusic();
            }
        }
        
        // Show specific screen
        function showScreen(screenIndex) {
            // Hide all screens
            screens.forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show selected screen
            screens[screenIndex].classList.remove('hidden');
            currentScreen = screenIndex;
        }
        
        // Load a location
        function loadLocation(locationIndex) {
            currentLocation = locationIndex;
            foundMessages = 0;
            
            const location = locations[locationIndex];
            locationTitle.textContent = location.name;
            
            // Clear previous content
            streetviewContainer.innerHTML = '';
            
            // Create iframe for Street View
            const iframe = document.createElement('iframe');
            iframe.src = location.streetViewUrl;
            iframe.allowFullscreen = true;
            iframe.loading = 'lazy';
            iframe.referrerPolicy = 'no-referrer-when-downgrade';
            streetviewContainer.appendChild(iframe);
            
            // Add heart markers after iframe loads
            setTimeout(() => {
                addHeartMarkers(location);
                createProgressDots(location.messages.length);
            }, 1500);
        }
        
        // Add heart markers to the location
        function addHeartMarkers(location) {
            location.heartPositions.forEach((position, index) => {
                const heartMarker = document.createElement('div');
                heartMarker.className = 'heart-marker';
                heartMarker.style.left = `${position.x}%`;
                heartMarker.style.top = `${position.y}%`;
                heartMarker.innerHTML = '<i class="fas fa-heart"></i>';
                heartMarker.dataset.index = index;
                
                // Add click handler
                heartMarker.addEventListener('click', () => {
                    showMessage(location.messages[index], index);
                    heartMarker.classList.add('found');
                });
                
                streetviewContainer.appendChild(heartMarker);
            });
        }
        
        // Create progress dots for messages
        function createProgressDots(totalMessages) {
            const progressContainer = document.querySelector('.progress-container');
            // Keep the progress text
            const progressText = progressContainer.querySelector('.progress-text');
            progressContainer.innerHTML = '';
            progressContainer.appendChild(progressText);
            
            for (let i = 0; i < totalMessages; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i === 0) dot.classList.add('active');
                progressContainer.appendChild(dot);
            }
        }
        
        // Update progress dots
        function updateProgressDots() {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active');
                if (index < foundMessages) {
                    dot.classList.add('found');
                } else if (index === foundMessages) {
                    dot.classList.add('active');
                }
            });
            
            // Update progress text
            const progressText = document.querySelector('.progress-text');
            progressText.textContent = `Memories found: ${foundMessages}/${locations[currentLocation].messages.length}`;
        }
        
        // Show a message
        function showMessage(message, messageIndex) {
            messageTitle.textContent = `Memory ${messageIndex + 1}`;
            messageText.textContent = message;
            messageOverlay.classList.add('active');
            
            // Update progress
            foundMessages++;
            updateProgressDots();
            
            // Enable continue button if all messages found
            if (foundMessages >= locations[currentLocation].messages.length) {
                continueMessageBtn.disabled = false;
                continueMessageBtn.textContent = "Continue to Next Location";
            } else {
                continueMessageBtn.disabled = true;
                continueMessageBtn.textContent = `Find ${locations[currentLocation].messages.length - foundMessages} more message${locations[currentLocation].messages.length - foundMessages > 1 ? 's' : ''}`;
            }
        }
        
        // Close message overlay
        function closeMessage() {
            messageOverlay.classList.remove('active');
        }
        
        // Continue to next location or final screen
        function continueToNext() {
            closeMessage();
            
            // If all messages found, go to next location or final screen
            if (foundMessages >= locations[currentLocation].messages.length) {
                if (currentLocation < locations.length - 1) {
                    // Load next location
                    loadLocation(currentLocation + 1);
                } else {
                    // All locations done, show final screen
                    showScreen(4);
                }
            }
        }
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
