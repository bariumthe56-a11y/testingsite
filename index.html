<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>testingsite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
            user-select: none;
            touch-action: manipulation;
        }
        
        /* Screen styles */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: opacity 1s ease, transform 1s ease;
            z-index: 10;
        }
        
        .screen.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }
        
        /* Start screen */
        #start-screen {
            background: linear-gradient(135deg, #000000 0%, #1a001a 100%);
            z-index: 100;
            cursor: pointer;
            padding: 20px;
        }
        
        .touch-to-continue {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: #ff5e8e;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Name screen */
        #name-screen {
            background: linear-gradient(135deg, #1a001a 0%, #330033 100%);
            cursor: pointer;
            padding: 20px;
        }
        
        .heart-icon {
            font-size: 60px;
            color: #ff5e8e;
            margin-bottom: 20px;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .recipient-name {
            font-family: 'Dancing Script', cursive;
            font-size: 64px;
            color: #ff5e8e;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 94, 142, 0.5);
        }
        
        /* Memory screen */
        #memory-screen {
            background: linear-gradient(135deg, #330033 0%, #660066 100%);
            cursor: pointer;
            padding: 20px;
        }
        
        .memory-text {
            font-size: 48px;
            color: #ffb6c1;
            font-family: 'Dancing Script', cursive;
            margin-bottom: 30px;
        }
        
        /* Location screen */
        #location-screen {
            background-color: #000;
            display: block;
            padding: 0;
        }
        
        .location-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .location-header {
            padding: 15px 20px;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 20;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7);
            position: relative;
            flex-shrink: 0;
        }
        
        .location-title {
            font-size: 24px;
            color: #ff5e8e;
            margin-bottom: 5px;
        }
        
        .location-instructions {
            font-size: 14px;
            color: #ffb6c1;
            margin-bottom: 10px;
        }
        
        .streetview-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }
        
        #streetview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* Message overlay */
        .message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.85);
        }
        
        .message-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .message-content {
            max-width: 600px;
            width: 90%;
            background: linear-gradient(135deg, rgba(102, 0, 102, 0.95), rgba(51, 0, 51, 0.95));
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            border: 3px solid #ff5e8e;
            position: relative;
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-message-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 94, 142, 0.2);
            border: none;
            color: #ffb6c1;
            font-size: 20px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 5;
        }
        
        .close-message-btn:hover {
            background-color: rgba(255, 94, 142, 0.4);
            color: #fff;
            transform: rotate(90deg);
        }
        
        .message-title {
            font-size: 22px;
            color: #ffb6c1;
            margin-bottom: 15px;
            font-family: 'Dancing Script', cursive;
            text-align: center;
        }
        
        .message-text {
            font-size: 17px;
            line-height: 1.6;
            color: #fff;
            margin-bottom: 25px;
            text-align: center;
            padding: 0 10px;
        }
        
        .message-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .message-btn {
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            border: none;
            min-width: 140px;
        }
        
        .continue-message-btn {
            background: linear-gradient(to right, #ff5e8e, #ff3d7a);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 94, 142, 0.4);
        }
        
        .continue-message-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 94, 142, 0.6);
        }
        
        .close-message-btn-small {
            background: rgba(255, 255, 255, 0.1);
            color: #ffb6c1;
            border: 1px solid rgba(255, 94, 142, 0.3);
        }
        
        .close-message-btn-small:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateY(-3px);
        }
        
        /* Heart markers*/
        .heart-marker {
            position: absolute;
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #ff5e8e, #ff3d7a);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 25px rgba(255, 94, 142, 0.9);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 25;
            animation: pulse 2s infinite;
            border: 3px solid white;
        }
        
        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 94, 142, 0.8), 0 0 40px rgba(255, 94, 142, 0.4); 
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 94, 142, 1), 0 0 60px rgba(255, 94, 142, 0.6); 
            }
        }
        
        .heart-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 35px rgba(255, 94, 142, 1);
        }
        
        .heart-marker.found {
            opacity: 0.4;
            transform: translate(-50%, -50%) scale(0.7);
            pointer-events: none;
            animation: none;
            background: #888;
            border-color: #aaa;
        }
        
        .heart-marker i {
            color: white;
            font-size: 26px;
        }
        
        /* Progress bar */
        .progress-overlay {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 25;
            padding: 0 20px;
        }
        
        .progress-container {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 94, 142, 0.5);
            backdrop-filter: blur(5px);
            max-width: 500px;
            width: 100%;
        }
        
        .progress-text {
            color: #ffb6c1;
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .progress-dots {
            display: flex;
            gap: 10px;
            flex: 1;
            justify-content: center;
        }
        
        .progress-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #444;
            transition: all 0.3s;
        }
        
        .progress-dot.active {
            background-color: #ff5e8e;
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(255, 94, 142, 0.7);
        }
        
        .progress-dot.found {
            background-color: #ffb6c1;
        }
        
        /* Next location button */
        .next-location-btn {
            position: absolute;
            bottom: 90px;
            right: 20px;
            background: linear-gradient(to right, #ff5e8e, #ff3d7a);
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            box-shadow: 0 5px 20px rgba(255, 94, 142, 0.6);
            z-index: 25;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
        
        .next-location-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
            animation: slideInUp 0.5s ease;
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .next-location-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 94, 142, 0.8);
        }
        
        /* Final screen */
        #final-screen {
            background: linear-gradient(135deg, #000033 0%, #330033 100%);
            overflow-y: auto;
            padding: 20px;
            cursor: default;
            justify-content: flex-start;
        }
        
        .love-letter-container {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            border: 3px solid #ff5e8e;
            animation: fadeIn 1.5s ease;
            margin: 20px auto;
            width: 90%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .love-letter-header {
            font-family: 'Dancing Script', cursive;
            font-size: 42px;
            color: #ff5e8e;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .love-letter-content {
            font-size: 18px;
            line-height: 1.8;
            color: #fff;
            white-space: pre-line;
            text-align: left;
            max-height: none;
            overflow: visible;
        }
        
        .final-heart {
            font-size: 70px;
            color: #ff5e8e;
            margin-top: 40px;
            animation: heartbeat 1.5s infinite;
            text-align: center;
        }
        
        /* Music player */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.9);
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 94, 142, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .music-btn {
            background: none;
            border: none;
            color: #ff5e8e;
            font-size: 24px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .music-btn:hover {
            background-color: rgba(255, 94, 142, 0.2);
            transform: scale(1.1);
        }
        
        .music-info {
            font-size: 15px;
            color: #ffb6c1;
            font-weight: 500;
        }
        
        /* Music loading indicator */
        .music-loading {
            font-size: 12px;
            color: #ffb6c1;
            animation: pulse 1.5s infinite;
        }
        
        /* Location navigation */
        .location-nav {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 20;
        }
        
        .location-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }
        
        .location-dot.active {
            background-color: #ff5e8e;
            transform: scale(1.3);
        }
        
        .location-dot.visited {
            background-color: #ffb6c1;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .recipient-name {
                font-size: 48px;
            }
            
            .memory-text {
                font-size: 36px;
            }
            
            .location-title {
                font-size: 20px;
            }
            
            .location-instructions {
                font-size: 13px;
            }
            
            .love-letter-header {
                font-size: 36px;
            }
            
            .love-letter-content {
                font-size: 17px;
                line-height: 1.7;
            }
            
            .heart-marker {
                width: 50px;
                height: 50px;
            }
            
            .message-content {
                padding: 25px 20px;
            }
            
            .message-btn {
                padding: 10px 20px;
                min-width: 120px;
                font-size: 15px;
            }
            
            .message-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .next-location-btn {
                bottom: 100px;
                right: 50%;
                transform: translateX(50%) translateY(20px);
                font-size: 15px;
                padding: 12px 25px;
            }
            
            .next-location-btn.visible {
                transform: translateX(50%) translateY(0);
            }
            
            .progress-container {
                padding: 10px 20px;
            }
            
            .love-letter-container {
                padding: 30px 25px;
                margin: 15px auto;
            }
            
            .music-player {
                bottom: 15px;
                right: 15px;
                padding: 10px 20px;
            }
        }
        
        @media (max-width: 480px) {
            .recipient-name {
                font-size: 36px;
            }
            
            .memory-text {
                font-size: 28px;
            }
            
            .love-letter-header {
                font-size: 32px;
            }
            
            .love-letter-content {
                font-size: 16px;
                line-height: 1.6;
            }
            
            .love-letter-container {
                padding: 25px 20px;
                margin: 10px auto;
            }
            
            .heart-marker {
                width: 45px;
                height: 45px;
            }
            
            .heart-marker i {
                font-size: 22px;
            }
            
            .message-content {
                padding: 20px 15px;
            }
            
            .next-location-btn {
                bottom: 110px;
                width: 90%;
                justify-content: center;
            }
            
            .progress-container {
                padding: 8px 15px;
            }
            
            .progress-text {
                font-size: 13px;
            }
            
            .music-player {
                bottom: 10px;
                right: 10px;
                padding: 8px 15px;
            }
            
            .music-info {
                display: none;
            }
        }
        
        /* Ensure the final screen scrolls properly */
        @media (max-height: 700px) {
            #final-screen {
                padding-top: 10px;
            }
            
            .love-letter-container {
                margin-top: 10px;
                padding: 25px 20px;
            }
            
            .love-letter-header {
                font-size: 34px;
                margin-bottom: 20px;
            }
            
            .love-letter-content {
                font-size: 16px;
                line-height: 1.6;
            }
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="start-screen" class="screen">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <h1 style="font-size: 36px; color: #ff5e8e; margin-bottom: 20px;"></h1>
        <p style="font-size: 20px; color: #ffb6c1; max-width: 600px; line-height: 1.6; padding: 0 20px;">
            
        </p>
        <div class="touch-to-continue">
            <i class="fas fa-hand-point-up"></i> Touch anywhere to continue
        </div>
    </div>
    
    <!-- Name Screen -->
    <div id="name-screen" class="screen hidden">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <p style="font-size: 24px; color: #ffb6c1; margin-bottom: 10px;">To</p>
        <h1 id="recipient-name" class="recipient-name">Julia</h1>
        <p style="font-size: 20px; color: #ffb6c1; margin-top: 20px; max-width: 600px; padding: 0 20px;">
            hopefully you don't find this cringe, but every moment with you is a treasure
        </p>
    </div>
    
    <!-- Memory Screen -->
    <div id="memory-screen" class="screen hidden">
        <div class="heart-icon">
            <i class="fas fa-heart"></i>
        </div>
        <h1 class="memory-text">Remember...</h1>
        <p style="font-size: 22px; color: #ffb6c1; max-width: 700px; line-height: 1.6; padding: 0 20px;">
            <br>
        </p>
    </div>
    
    <!-- Location Screen -->
    <div id="location-screen" class="screen hidden">
        <div class="location-container">
            <div class="location-header">
                <h1 id="location-title" class="location-title">Our First Date</h1>
                <p class="location-instructions">
                    <i class="fas fa-heart" style="color: #ff5e8e;"></i> 
                    Click on the glowing hearts to reveal hidden messages
                </p>
                <div class="location-nav" id="location-nav">

                </div>
            </div>
            <div class="streetview-container">
                <iframe id="streetview-iframe"></iframe>
                

                
                <!-- Message overlay -->
                <div id="message-overlay" class="message-overlay">
                    <div class="message-content">
                        <button id="close-message-btn" class="close-message-btn" title="Close message">
                            <i class="fas fa-times"></i>
                        </button>
                        <h2 id="message-title" class="message-title">A Special Memory</h2>
                        <p id="message-text" class="message-text">
                            test
                        </p>
                        <div class="message-actions">
                            <button id="continue-message-btn" class="message-btn continue-message-btn">Continue</button>
                            <button id="close-message-btn-small" class="message-btn close-message-btn-small">Close</button>
                        </div>
                    </div>
                </div>
                
                <!-- Next location button -->
                <button id="next-location-btn" class="next-location-btn">
                    <i class="fas fa-arrow-right"></i> Next Location
                </button>
                
                <!-- Progress overlay -->
                <div class="progress-overlay">
                    <div class="progress-container">
                        <span class="progress-text">Memories found:</span>
                        <div class="progress-dots" id="progress-dots">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Final Screen -->
    <div id="final-screen" class="screen hidden">
        <div class="love-letter-container">
            <h1 id="love-letter-header" class="love-letter-header">fillers</h1>
            <div id="love-letter-content" class="love-letter-content">
                filler
            </div>
            <div class="final-heart">
                <i class="fas fa-heart"></i>
            </div>
        </div>
    </div>
    
    <!-- Music Player -->
    <div class="music-player">
        <button id="music-toggle" class="music-btn" title="Toggle music">
            <i class="fas fa-volume-up"></i>
        </button>
        <div id="music-info" class="music-info">
            Click to play music
        </div>
    </div>

    <script>
        // ================================
        // CUSTOMIZATION SECTION
        // ================================
        
        const recipientName = "Julia";
        
        const loveMessage = {
            header: "words, words, words",
            content: `Dear Joules,

As you read this (assuming it is 'shipped' by Feb 14th), we will have been together for 10 months [2 months short of 1 year!!! (does this count for an anniversary present? - just kidding lol I hope I'll think of something else)], 6 of which we were physically apart. Yet despite more than half our time together being ten thousand kilometers apart, more than half my thoughts everyday are of you, ten thousand times more than what I probably should be thinking about. So uh thanks!

It's really hard to describe your allure, because you're beautiful in so many aspects that if I were to simply list them all (caring, optimistic, passionate, mesmerizing, bubbly...), this code will not be very readable. Perhaps an adjective can simplify this conundrum - I love Julia Julia (here Julia is an adjective and a noun, I don't know why I am explaining this). If everything in life was Julia, then it would be a very Julia life. And although I obviously deeply miss the Julia-y proximity, your Julianess, whether from our time together or from across the screen, has inspired and changed me into a Julia-er version of myself, and I will try my best to be more Julia to you (I realize this passage is quite vague but I really like the sound of Julia in my head, so yay. also the code is still unreadable lmao). 

No matter where life takes us, my heart will always find its home with you. Thank you for every moment, every memory, and every tomorrow we'll share together!

With lots of love and words,
Barry`
        };
        
        // location & messages
        const locations = [
            {
                name: "when it started",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1770832558920!6m8!1m7!1sGprMPWj2jRggTHCTa8nTZA!2m2!1d51.10017156893773!2d-114.1427037657277!3f73.76155427371963!4f-9.639462526831991!5f0.5253201611357337",
                messages: [
                    "I still can't believe all of this started because of a) Nathan being late for physics and b) you tolerating (and I guess for whatever reason enjoying) my sleep-deprived rambling.",
                    "Don't know if you know this, but the time we went for boba was the first time I ever bought boba for myself. And even though the boba was pretty darn sweet, guess who was even sweeter? :P",
                    "How many times did we go to that bench outside of Johnson's room? Churchill should invest in constructing better date environments."
                ],
                heartPositions: [
                    { x: 25, y: 45 },  // Percentage positions
                    { x: 65, y: 35 },
                    { x: 45, y: 65 }
                ]
            },
            {
                name: "prom!",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1770832772686!6m8!1m7!1sGYg20xCnCcVQ353orR0A0w!2m2!1d51.04948973198903!2d-114.0692954422088!3f312.2309134096923!4f19.46790083810953!5f0.4000000000000002",
                messages: [
                    "Without you, I would have strongly resisted going to prom lol - but your smile, your energy, and your laugh made the awkwardness all worth it",
                    "Objectively, being with you for even one minute is better than one bruschetta crostini (You know how much this means!)",
                    "thanks for reaching over to hold my hand in the car :D - I never knew I could want something that much, and you somehow read my mind"
                ],
                heartPositions: [
                    { x: 30, y: 55 },
                    { x: 60, y: 40 },
                    { x: 75, y: 65 }
                ]
            },
            {
                name: "a nice view, eh?",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1770832917978!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJQ2xoYWY4R1E.!2m2!1d51.13816534996297!2d-114.1512678921037!3f34.45831093596655!4f-4.793394168555693!5f0.7820865974627469",
                messages: [
                    "The view from this bench doesn't matter because the only view I was and still am interested in was to my left.",
                    "This Street View was captured around when we started debating together. This is also one of the only segments captured in the ravine! Maybe this means something :)",
                    "Now, I don't exactly remember what we talked about, maybe it was your internship, or maybe Waterloo updates, but I still vividly remember how we sat awkwardly apart for some reason at the beginning. Perhaps that is something to take note of for next time :D"
                ],
                heartPositions: [
                    { x: 40, y: 40 },
                    { x: 70, y: 55 },
                    { x: 30, y: 70 }
                ]
            },
            {
                name: "a movie",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1770833024133!6m8!1m7!1svLaBMYoa4bCPXKkpZn0geA!2m2!1d51.12757446215573!2d-114.2022223799432!3f99.85227983566212!4f-16.39670677305874!5f0.7820865974627469",
                messages: [
                    "I'm still curious why you chose Jurassic World when you said you didn't want to watch horror lol",
                    "Weirdly, I don't remember much from the movie itself, but I remember taking laps with you around Crowfoot Terrace under the setting sun",
                    "I thought the setting sun was symbolic for the relationship ending (good ol' pessimist me). It obviously wasn't. Instead, in the enroaching darkness, what I followed was not my eyes but your voice and giggles, your perfume (I'M NOT GRENOUILLE I SWEAR), your intentional bumps into me - even when times get dark, we will be there for each other to follow"
                ],
                heartPositions: [
                    { x: 35, y: 35 },
                    { x: 60, y: 50 },
                    { x: 50, y: 75 }
                ]
            },
            {
                name: "a nicer view :)",
                streetViewUrl: "https://www.google.com/maps/embed?pb=!4v1770833104581!6m8!1m7!1sCAoSHENJQUJJaEFpWGRVbFdYU3YxNlZCQXNQYmJrVDc.!2m2!1d51.13284204578285!2d-114.1532042699939!3f111.36486949477784!4f-3.6751061102211935!5f0.7820865974627469",
                messages: [
                    "I don't think this one needs an explanation, but man, we really love benches don't we?",
                    "I still the memory of you chasing away the crow so adorable.",
                    "One day, we shall return to this bench, shoulder to shoulder, hand in hand, and get willingly attacked by the Calgarian Chinook. One day."
                ],
                heartPositions: [
                    { x: 45, y: 40 },
                    { x: 40, y: 65 },
                    { x: 65, y: 70 }
                ]
            }
        ];
        
        
        let currentScreen = 0;
        let currentLocation = 0;
        let foundMessages = 0;
        let musicPlaying = false;
        let musicInitialized = false;
        let heartMarkers = [];
        
        const screens = [
            document.getElementById('start-screen'),
            document.getElementById('name-screen'),
            document.getElementById('memory-screen'),
            document.getElementById('location-screen'),
            document.getElementById('final-screen')
        ];
        
        const recipientNameElement = document.getElementById('recipient-name');
        const locationTitle = document.getElementById('location-title');
        const streetviewIframe = document.getElementById('streetview-iframe');
        const messageOverlay = document.getElementById('message-overlay');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const continueMessageBtn = document.getElementById('continue-message-btn');
        const closeMessageBtn = document.getElementById('close-message-btn');
        const closeMessageBtnSmall = document.getElementById('close-message-btn-small');
        const nextLocationBtn = document.getElementById('next-location-btn');
        const loveLetterHeader = document.getElementById('love-letter-header');
        const loveLetterContent = document.getElementById('love-letter-content');
        const musicToggle = document.getElementById('music-toggle');
        const musicInfo = document.getElementById('music-info');
        const locationNav = document.getElementById('location-nav');
        const progressDots = document.getElementById('progress-dots');
        
        const backgroundMusic = new Audio();
        
        function initializeMusic() {
            backgroundMusic.src = "https://cdn.jsdelivr.net/gh/bariumthe56-a11y/testingsite/ditml.mp3";
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.7;
            backgroundMusic.preload = "auto";
            
            backgroundMusic.load();
            
            musicInfo.textContent = "Click to play";
            musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
            musicToggle.title = "Play music";
            
            console.log("Music initialized and ready");
        }
        
        function playMusic() {
            if (!musicInitialized) {
                initializeMusic();
                musicInitialized = true;
            }
            
            const playPromise = backgroundMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // Music started successfully
                    musicPlaying = true;
                    musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                    musicInfo.textContent = "Romantic Music";
                    musicToggle.title = "Pause music";
                    console.log("Music playing successfully");
                }).catch(error => {
                    // Music failed to start
                    console.log("Music play failed, waiting for user interaction:", error);
                    musicInfo.textContent = "Click to play";
                    musicToggle.title = "Play music (click first)";
                    
                    // Set up a one-time interaction listener
                    const startOnInteraction = () => {
                        backgroundMusic.play().then(() => {
                            musicPlaying = true;
                            musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                            musicInfo.textContent = "Romantic Music";
                            musicToggle.title = "Pause music";
                            console.log("Music started after user interaction");
                        }).catch(e => {
                            console.log("Still can't play music:", e);
                        });
                        
                        // Remove the listener after first interaction
                        document.removeEventListener('click', startOnInteraction);
                        document.removeEventListener('touchstart', startOnInteraction);
                    };
                    
                    document.addEventListener('click', startOnInteraction);
                    document.addEventListener('touchstart', startOnInteraction);
                });
            }
        }
        
        // Pause music
        function pauseMusic() {
            backgroundMusic.pause();
            musicPlaying = false;
            musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
            musicInfo.textContent = "Music paused";
            musicToggle.title = "Play music";
        }
        
        // Toggle music
        function toggleMusic() {
            if (musicPlaying) {
                pauseMusic();
            } else {
                playMusic();
            }
        }
        
        // Initialize the application
        function init() {
            // Set recipient name
            recipientNameElement.textContent = recipientName;
            
            loveLetterHeader.textContent = loveMessage.header;
            loveLetterContent.textContent = loveMessage.content;
            
            setupEventListeners();
            
            initializeMusic();
            
            // Show first screen
            showScreen(0);
            
            setTimeout(() => {
                playMusic();
            }, 500);
        }
        
        // Setup all event listeners
        function setupEventListeners() {
            // Screen click handlers - FIXED: Music starts on first click
            const startMusicOnFirstClick = () => {
                if (!musicPlaying) {
                    playMusic();
                }
            };
            
            screens[0].addEventListener('click', () => {
                startMusicOnFirstClick();
                showScreen(1);
            });
            screens[1].addEventListener('click', () => {
                startMusicOnFirstClick();
                showScreen(2);
            });
            screens[2].addEventListener('click', () => {
                startMusicOnFirstClick();
                showScreen(3);
                setTimeout(() => {
                    loadLocation(0);
                }, 100);
            });
            
            // Message buttons
            continueMessageBtn.addEventListener('click', continueToNext);
            closeMessageBtn.addEventListener('click', closeMessage);
            closeMessageBtnSmall.addEventListener('click', closeMessage);
            
            // Next location button
            nextLocationBtn.addEventListener('click', goToNextLocation);
            
            musicToggle.addEventListener('click', toggleMusic);
            
            // Keyboard support
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && messageOverlay.classList.contains('active')) {
                    closeMessage();
                }
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    if (nextLocationBtn.classList.contains('visible')) {
                        goToNextLocation();
                    }
                }
            });
            
            document.addEventListener('click', () => {
                if (!musicPlaying) {
                    playMusic();
                }
            }, { once: true });
        }
        
        // Show specific screen
        function showScreen(screenIndex) {
            screens.forEach(screen => {
                screen.classList.add('hidden');
            });
            
            screens[screenIndex].classList.remove('hidden');
            currentScreen = screenIndex;
            
            if (screenIndex === 4) {
                screens[4].scrollTop = 0;
                setTimeout(() => {
                    const letterContainer = document.querySelector('.love-letter-container');
                    if (letterContainer) {
                        letterContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        }
        
        // Load a location
        function loadLocation(locationIndex) {
            currentLocation = locationIndex;
            foundMessages = 0;
            
            const location = locations[locationIndex];
            locationTitle.textContent = location.name;
            
            streetviewIframe.src = location.streetViewUrl + "&output=embed&hl=en&ui=off";
            
            clearHeartMarkers();
            
            setTimeout(() => {
                addHeartMarkers(location);
                createProgressDots(location.messages.length);
                createLocationNav();
                updateNextButton();
            }, 1500);
        }
        
        // Clear heart markers
        function clearHeartMarkers() {
            heartMarkers.forEach(marker => {
                if (marker && marker.parentNode) {
                    marker.parentNode.removeChild(marker);
                }
            });
            heartMarkers = [];
        }
        
        // Add heart markers to the location
        function addHeartMarkers(location) {
            location.heartPositions.forEach((position, index) => {
                const heartMarker = document.createElement('div');
                heartMarker.className = 'heart-marker';
                heartMarker.style.left = `${position.x}%`;
                heartMarker.style.top = `${position.y}%`;
                heartMarker.innerHTML = '<i class="fas fa-heart"></i>';
                heartMarker.dataset.index = index;
                
                heartMarker.addEventListener('click', () => {
                    showMessage(location.messages[index], index);
                    heartMarker.classList.add('found');
                });
                
                streetviewIframe.parentNode.appendChild(heartMarker);
                heartMarkers.push(heartMarker);
            });
        }
        
        // Create progress dots
        function createProgressDots(totalMessages) {
            progressDots.innerHTML = '';
            
            for (let i = 0; i < totalMessages; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i === 0) dot.classList.add('active');
                progressDots.appendChild(dot);
            }
            
            updateProgressText();
        }
        
        // Create location navigation dots
        function createLocationNav() {
            locationNav.innerHTML = '';
            
            locations.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'location-dot';
                if (index === currentLocation) {
                    dot.classList.add('active');
                } else if (index < currentLocation) {
                    dot.classList.add('visited');
                }
                locationNav.appendChild(dot);
            });
        }
        
        // Update progress
        function updateProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active');
                if (index < foundMessages) {
                    dot.classList.add('found');
                } else if (index === foundMessages) {
                    dot.classList.add('active');
                }
            });
            
            updateProgressText();
            updateNextButton();
        }
        
        // Update progress text
        function updateProgressText() {
            const progressText = document.querySelector('.progress-text');
            progressText.textContent = `Memories found: ${foundMessages}/${locations[currentLocation].messages.length}`;
        }
        
        // Update next button visibility
        function updateNextButton() {
            if (foundMessages >= locations[currentLocation].messages.length) {
                nextLocationBtn.classList.add('visible');
                nextLocationBtn.innerHTML = currentLocation < locations.length - 1 
                    ? '<i class="fas fa-arrow-right"></i> Next Location' 
                    : '<i class="fas fa-heart"></i> Read Love Letter';
            } else {
                nextLocationBtn.classList.remove('visible');
            }
        }
        
        // Show a message
        function showMessage(message, messageIndex) {
            messageTitle.textContent = `Memory ${messageIndex + 1}`;
            messageText.textContent = message;
            messageOverlay.classList.add('active');
            
            foundMessages++;
            updateProgress();
            
            if (foundMessages >= locations[currentLocation].messages.length) {
                continueMessageBtn.textContent = "Continue";
            } else {
                continueMessageBtn.textContent = "Next Memory";
            }
        }
        
        // Close message overlay
        function closeMessage() {
            messageOverlay.classList.remove('active');
        }
        
        // Continue to next message or location
        function continueToNext() {
            closeMessage();
            
            if (foundMessages >= locations[currentLocation].messages.length) {
                goToNextLocation();
            }
        }
        
        // Go to next location or final screen
        function goToNextLocation() {
            closeMessage();
            
            if (currentLocation < locations.length - 1) {
                currentLocation++;
                loadLocation(currentLocation);
            } else {
                showScreen(4);
            }
        }
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
